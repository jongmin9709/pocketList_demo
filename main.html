<!doctype html>
<html>
<head>
<title>PocketList</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no">

<meta charset="utf-8">
<link rel="icon" type="image/x-icon" href="/image2.ico" />
<link rel="stylesheet" href="mainframe.css">

<script>
	var customLabel = {
        restaurant: {
          label: 'R'
        },
        Cafe: {
          label: 'C'
        }
      };
	var map, infoWindow, marker;
	function initMap() {
		//처음 화면 
		var CityHall = {lat:37.577, lng: 126.976}
		map = new google.maps.Map(document.getElementById('map'),{center: CityHall,zoom: 11});
		
		infoWindow = new google.maps.InfoWindow({map: map});
		//첫 화면 마커 설정(서울시청)
		infoWindow.setContent('서울시청')
		marker = new google.maps.Marker({position: CityHall,map: map});
		//마커를 클릭했을 때 
		marker.addListener('click', function() {map.setZoom(16);
        map.setCenter(marker.getPosition());
        });
		
		//자신의 위치 정보 가져오기
		function successCallback(position){
            let pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };
			infoWindow.setContent('your location');
            infoWindow.setPosition(pos);
            map.setCenter(pos);
            alert("Your Current position is:  latitude(" + pos.lat + "), longitude("+ pos.lng + ")");
			marker = new google.maps.Marker({position: pos,map: map});
        }
        function errorCallback(error){
            alert("Error: " + error.message);
        }
        document.getElementById("getLocation").onclick = function() {
            navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
        };
		// Change this depending on the name of your PHP or XML file
          downloadUrl('https://storage.googleapis.com/mapsdevsite/json/mapmarkers2.xml', function(data) {
            var xml = data.responseXML;
            var markers = xml.documentElement.getElementsByTagName('marker');
            Array.prototype.forEach.call(markers, function(markerElem) {
              var id = markerElem.getAttribute('id');
              var name = markerElem.getAttribute('name');
              var address = markerElem.getAttribute('address');
              var type = markerElem.getAttribute('type');
              var point = new google.maps.LatLng(
                  parseFloat(markerElem.getAttribute('lat')),
                  parseFloat(markerElem.getAttribute('lng')));

              var infowincontent = document.createElement('div');
              var strong = document.createElement('strong');
              strong.textContent = name
              infowincontent.appendChild(strong);
              infowincontent.appendChild(document.createElement('br'));

              var text = document.createElement('text');
              text.textContent = address
              infowincontent.appendChild(text);
              var icon = customLabel[type] || {};
              var marker = new google.maps.Marker({
                map: map,
                position: point,
                label: icon.label
              });
              marker.addListener('click', function() {
                infoWindow.setContent(infowincontent);
                infoWindow.open(map, marker);
              });
            });
          });
      }
	function downloadUrl(url, callback) {
        var request = window.ActiveXObject ?
            new ActiveXObject('Microsoft.XMLHTTP') :
            new XMLHttpRequest;

        request.onreadystatechange = function() {
          if (request.readyState == 4) {
            request.onreadystatechange = doNothing;
            callback(request, request.status);
          }
        };

        request.open('GET', url, true);
        request.send(null);
      }

      function doNothing() {}
</script>
<script src = "http://maps.googleapis.com/maps/api/js?key=AIzaSyBnE9AG2dhte6j5G9i9XOmFDhMOzijcCDg&callback=initMap"async defer></script>>


</head>
    <body>
    	<div class="container">
		<header>
			<input type="button" class="imabtn2" onclick="alert('민경아 사랑해')">
			<h1><a href="main.html">pocket List</a></h1>
			<form action="http://localhost/login.php" class="form">
				<input type="text" name="search" value="이건 미리 적혀있는거">
				<input type="submit" value = "" class="imabtn1">
  			</form>
		</header>
  		<div class="mainscreen">
   		<section class="content">
   			<nav>
   				<ul class="im1">
   					<li>맛집</li>
   					<li>축제</li>
   					<li>카페</li>
   					<li>전시</li>
   				</ul>
   				<input type="button" class="imabtn3" id="getLocation">
   			</nav>
   			<main id="map" >
   				
   			</main>
   		</section>
   		<footer>
   			<a href="https://map.kakao.com" title="2주만 버티자 존버는 승리한다"
   			target="_blank">그냥 이거 써</a>
   		</footer>
   		</div>
   		</div>
    </body>
</html>